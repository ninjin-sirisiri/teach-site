---
/**
 * Sidebarã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
 * ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã¨ãƒªãƒ³ã‚¯ã‚’å®Ÿè£…
 * ç¾åœ¨ã®ãƒ¬ãƒƒã‚¹ãƒ³ã®ãƒã‚¤ãƒ©ã‚¤ãƒˆ
 * Requirements: 4.2
 */

import { navSections } from '../data/navigation';

interface Props {
  /** ç¾åœ¨ã®ãƒ¬ãƒƒã‚¹ãƒ³IDï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰ */
  currentLessonId?: string;
}

const { currentLessonId } = Astro.props;
const basePath = import.meta.env.BASE_URL || '/teach-site/';
---

<aside class="sidebar" id="sidebar">
  <div class="sidebar-header">
    <a href={basePath} class="logo">
      <div class="logo-icon">ğŸš€</div>
      <span>Web Dev Learn</span>
    </a>
  </div>
  
  <nav>
    <!-- ãƒ›ãƒ¼ãƒ ãƒªãƒ³ã‚¯ -->
    <div class="nav-section">
      <div class="nav-list">
        <div class="nav-item">
          <a 
            href={basePath} 
            class:list={['nav-link', { active: !currentLessonId }]}
          >
            <span class="nav-icon">ğŸ </span>
            <span>ãƒ›ãƒ¼ãƒ </span>
          </a>
        </div>
      </div>
    </div>
    
    <!-- ãƒ¬ãƒƒã‚¹ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
    {navSections.map((section) => (
      <div class="nav-section">
        <div class="nav-section-title">{section.title}</div>
        <div class="nav-list">
          {section.items.map((item) => (
            <div class="nav-item">
              <a 
                href={`${basePath}lessons/${item.id}/`}
                class:list={['nav-link', { active: currentLessonId === item.id }]}
                data-lesson-id={item.id}
              >
                <span class="nav-icon">{item.icon}</span>
                <span>{item.label}</span>
                <span class="nav-completion" data-completion-for={item.id}></span>
              </a>
            </div>
          ))}
        </div>
      </div>
    ))}
  </nav>
</aside>

<script>
  // é€²æ—çŠ¶æ…‹ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§æ›´æ–°
  function updateCompletionMarks() {
    const STORAGE_KEY = 'webdev-learn-progress';
    
    try {
      const data = localStorage.getItem(STORAGE_KEY);
      if (data) {
        const progress = JSON.parse(data);
        const completedLessons: string[] = progress.completedLessons || [];
        
        // å„ãƒ¬ãƒƒã‚¹ãƒ³ã®å®Œäº†ãƒãƒ¼ã‚¯ã‚’æ›´æ–°
        document.querySelectorAll('[data-completion-for]').forEach((el) => {
          const lessonId = el.getAttribute('data-completion-for');
          if (lessonId && completedLessons.includes(lessonId)) {
            el.textContent = 'âœ“';
            el.classList.add('completed');
          }
        });
      }
    } catch (e) {
      console.warn('Failed to load progress:', e);
    }
  }
  
  // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
  document.addEventListener('DOMContentLoaded', updateCompletionMarks);
  // Astroã®ãƒšãƒ¼ã‚¸é·ç§»æ™‚ã«ã‚‚å®Ÿè¡Œ
  document.addEventListener('astro:page-load', updateCompletionMarks);
</script>
